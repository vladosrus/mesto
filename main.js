(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n=function(){function n(e){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"_handleEscClose",(function(e){"Escape"===e.key&&r.close()})),t(this,"_handleClosePopup",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup_opened"))&&r.close()})),this._popup=document.querySelector(e),this._escClose=this._handleEscClose.bind(this),this._submitButton=this._popup.querySelector(".popup__submit-button")}var r,o;return r=n,(o=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._escClose)}},{key:"close",value:function(){document.removeEventListener("keydown",this._escClose),this._popup.classList.remove("popup_opened")}},{key:"setEventListeners",value:function(){var e=this;this._popup.querySelector(".popup__close-icon").addEventListener("click",(function(){return e.close(e._popup)})),this._popup.addEventListener("click",this._handleClosePopup)}}])&&e(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=a(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},i.apply(this,arguments)}function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(f,e);var t,n,r,a,l=(r=f,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=s(r);if(a){var n=s(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),l.call(this,e)}return t=f,(n=[{key:"setSubmitFunction",value:function(e){this._handleSubmit=e}},{key:"setEventListeners",value:function(){i(s(f.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("click",this._handleSubmit)}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),f}(n);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=d(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},h.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function y(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(r);if(o){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function a(e){var t,n,r,o,c=e.submitForm,u=e.popupSelector;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o=function(e){e.preventDefault(),t._submitForm(t._getInputValues())},(r="_handleSubmitForm")in(n=b(t=i.call(this,u)))?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,t._submitForm=c,t._form=t._popup.querySelector(".popup__form"),t._inputList=t._form.querySelectorAll(".popup__input"),t}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.id]=t.value})),e}},{key:"setEventListeners",value:function(){h(m(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._handleSubmitForm)}},{key:"close",value:function(){h(m(a.prototype),"close",this).call(this),this._form.reset()}},{key:"isLoading",value:function(e,t,n){this._submitButton.textContent=e?n:t}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(n);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=C(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},w.apply(this,arguments)}function C(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}function S(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(r);if(o){var n=E(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return S(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupZoomImg=t._popup.querySelector(".popup__image"),t._popupZoomText=t._popup.querySelector(".popup__caption"),t}return t=a,(n=[{key:"open",value:function(e){this._popupZoomImg.src=e.link,this._popupZoomImg.alt=e.name,this._popupZoomText.textContent=e.name,w(E(a.prototype),"open",this).call(this)}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(n);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=n,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButtonSelector)}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){this._errorElement=this._form.querySelector(".".concat(e.id,"-error")),this._errorElement.textContent="",e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0))}},{key:"_setEventListeners",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t,n){var r=t.data,o=t.myId,i=t.handleCardClick,a=t.handleLikeCard,c=t.handleDislikeCard,u=t.handleBucketClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=r,this.cardId=r._id,this._title=r.name,this._link=r.link,this._myId=o,this._cardOwnerId=r.owner._id,this._cardLikes=r.likes,this._likeCount=r.likes.length,this._cardContainer=document.querySelector(n),this._handleCardClick=i,this._handleBucketClick=u,this._handleLikeCard=a,this._handleDislikeCard=c}var t,n;return t=e,(n=[{key:"_checkCardId",value:function(){return this._myId===this._cardOwnerId}},{key:"_getTemplate",value:function(){if(!1===this._checkCardId()){var e=this._cardContainer.content.querySelector(".element").cloneNode(!0);return e.querySelector(".element__basket-button").remove(),e}return this._cardContainer.content.querySelector(".element").cloneNode(!0)}},{key:"_isILikeCard",value:function(){var e=this;return this._cardLikes.some((function(t){return t._id.includes(e._myId)}))}},{key:"_getCardLike",value:function(){this._isILikeCard()?this._handleDislikeCard(this._data):this._handleLikeCard(this._data)}},{key:"_setEventListeners",value:function(){var e=this;this._likeButton=this._card.querySelector(".element__like-button"),this._likeButton.addEventListener("click",(function(){e._getCardLike(e)})),this._basket&&this._basket.addEventListener("click",(function(){e._handleBucketClick(e)})),this._сardImage.addEventListener("click",(function(){e._handleCardClick(e._title,e._link)}))}},{key:"addLike",value:function(e){this._cardLikes=e.likes,this._likeNumber.textContent=e.likes.length,this._likeButton.classList.add("element__like-button_active")}},{key:"deleteLike",value:function(e){this._cardLikes=e.likes,this._likeNumber.textContent=e.likes.length,this._likeButton.classList.remove("element__like-button_active")}},{key:"handleDeliteCard",value:function(){this._card.remove()}},{key:"generateNewCard",value:function(){return this._card=this._getTemplate(),this._card.id=this.cardId,this._basket=this._card.querySelector(".element__basket-button"),this._card.querySelector(".element__title").textContent=this._title,this._сardImage=this._card.querySelector(".element__image"),this._сardImage.src=this._link,this._сardImage.alt=this._title,this._likeNumber=this._card.querySelector(".element__like-count"),this._likeNumber.textContent=this._likeCount,this._setEventListeners(),this._card}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"clear",value:function(){this._container.innerHTML=""}},{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){e._renderer(t)}))}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t){var n=t.titleSelector,r=t.subtitleSelector,o=t.profileAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._title=document.querySelector(n),this._subtitle=document.querySelector(r),this._profileAvatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._profileValues={},this._profileValues.title=this._title.textContent,this._profileValues.subtitle=this._subtitle.textContent,this._profileValues}},{key:"setUserInfo",value:function(e){this._title.textContent=e.name,this._subtitle.textContent=e.about,this._profileAvatar.src=e.avatar}}])&&T(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseURL=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"getProfileInfo",value:function(){return fetch("".concat(this._baseURL,"/users/me"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseURL,"/cards"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"changeProfileInfo",value:function(e){return fetch("".concat(this._baseURL,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.job})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"changeProfileImg",value:function(e){return fetch("".concat(this._baseURL,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.profileImgLink})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"addNewCard",value:function(e){return fetch("".concat(this._baseURL,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.cardImgLink})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseURL,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"likeCard",value:function(e){return fetch("".concat(this._baseURL,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"deleteLike",value:function(e){return fetch("".concat(this._baseURL,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),D=document.querySelector(".popup_named_profile"),N=D.querySelector(".popup__input_named_name"),A=D.querySelector(".popup__input_named_job"),F=document.querySelector(".profile__edit-button"),Z=document.querySelector(".profile__add-button"),H=document.querySelector(".profile__avatar-overlay"),J={inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},z=document.querySelector("#profileform"),M=document.querySelector("#cardform"),G=document.querySelector("#imageform"),K=new V({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-44",headers:{authorization:"4b7b5dd1-c14a-477d-bd33-50408ed7db39","Content-Type":"application/json"}}),Q=new x({titleSelector:".profile__title",subtitleSelector:".profile__subtitle",profileAvatarSelector:".profile__avatar"}),W=null;K.getProfileInfo().then((function(e){return Q.setUserInfo(e),W=e._id})).catch((function(e){console.log(e)}));var X=new v({submitForm:function(e){X.isLoading(!0,"Сохранить","Сохранение..."),K.changeProfileInfo(e).then((function(e){Q.setUserInfo(e)})).catch((function(e){console.log(e)})).finally((function(){X.isLoading(!1,"Сохранить","Сохранение...")})),X.close()},popupSelector:".popup_named_profile"});X.setEventListeners(),F.addEventListener("click",(function(){var e=Q.getUserInfo();N.value=e.title,A.value=e.subtitle,X.open(),oe.resetValidation()}));var Y=new v({submitForm:function(e){Y.isLoading(!0,"Сохранить","Сохранение..."),K.changeProfileImg(e).then((function(e){Q.setUserInfo(e),Y.close()})).catch((function(e){console.log(e)})).finally((function(){Y.isLoading(!1,"Сохранить","Сохранение...")}))},popupSelector:".popup_named_profile-image"});function $(e){var t=new B({items:e,renderer:function(e){t.addItem(ne(e))}},".elements__list");return t}Y.setEventListeners(),H.addEventListener("click",(function(){Y.open(),ae.resetValidation()})),K.getInitialCards().then((function(e){$(e).renderItems()})).catch((function(e){console.log(e)}));var ee=new l(".popup_named_delete");ee.setEventListeners();var te=new O(".popup_named_zoom");function ne(e){var t=new R({data:e,myId:W,handleCardClick:function(){te.open(e)},handleLikeCard:function(e){K.likeCard(e._id).then((function(e){t.addLike(e)})).catch((function(e){console.log(e)}))},handleDislikeCard:function(e){K.deleteLike(e._id).then((function(e){t.deleteLike(e)})).catch((function(e){console.log(e)}))},handleBucketClick:function(e){ee.open(),ee.setSubmitFunction((function(){K.deleteCard(e.cardId).then((function(){t.handleDeliteCard(),ee.close()})).catch((function(e){console.log(e)}))})),ee.setEventListeners()}},".card");return t.generateNewCard()}te.setEventListeners();var re=new v({submitForm:function(e){e.name=e.imgname,delete e.imgname,re.isLoading(!0,"Создать","Создание..."),K.addNewCard(e).then((function(e){$(e).addItem(ne(e))})).catch((function(e){console.log(e)})).finally((function(){re.isLoading(!1,"Создать","Создание...")})),re.close()},popupSelector:".popup_named_card"});re.setEventListeners(),Z.addEventListener("click",(function(){re.open(),ie.resetValidation()}));var oe=new P(J,z),ie=new P(J,M),ae=new P(J,G);oe.enableValidation(),ie.enableValidation(),ae.enableValidation()})();
//# sourceMappingURL=main.js.map